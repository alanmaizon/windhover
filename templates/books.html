{% extends "base.html" %}

{% block title %}Books{% endblock %}

{% block content %}
<div class="row">
    <!-- Add Book Form (left side) -->
    <div class="col-md-3">
        <form action="/books" method="POST" enctype="multipart/form-data" class="add-form">
            <fieldset>
                <legend>Add a New Book</legend>
        
                <div class="mb-3">
                    <label for="isbn" class="form-label">ISBN:</label>
                    <input type="text" id="isbn" name="isbn" class="form-control" required pattern="\d{10}|\d{13}" title="ISBN must be 10 or 13 digits" aria-describedby="isbnHelp">
                    <div id="isbnHelp" class="form-text">ISBN should be 10 or 13 digits long.</div>
                </div>
        
                <div class="mb-3">
                    <label for="title" class="form-label">Title:</label>
                    <input type="text" id="title" name="title" class="form-control" required aria-label="Book Title">
                </div>
        
                <div class="mb-3">
                    <label for="author" class="form-label">Author:</label>
                    <input type="text" id="author" name="author" class="form-control" required aria-label="Author Name">
                </div>
        
                <div class="mb-3">
                    <label for="publisher" class="form-label">Publisher:</label>
                    <input type="text" id="publisher" name="publisher" class="form-control" required aria-label="Publisher Name">
                </div>
        
                <div class="mb-3">
                    <label for="publicationyear" class="form-label">Publication Year:</label>
                    <select id="publicationyear" name="publicationyear" class="form-select" required aria-label="Select Publication Year">
                        {% for year in range(current_year, 1899, -1) %}
                            <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="mb-3">
                    <label for="image" class="form-label">Book Cover Image:</label>
                    <input type="file" id="image" name="image" accept="image/*" class="form-control" aria-label="Upload Book Cover Image">
                </div>
        
                <button type="submit" class="btn btn-primary" aria-label="Add Book">Add Book</button>
            </fieldset>
        </form>
    </div>
    
    <div class="col-md-9">
        <!-- Row to contain the forms and filters -->
        <div class="row">
            <h2>Book List</h2>
            
            <!-- Search Form -->
            <div class="col-md-9">
                <form id="search-form" class="mb-3">
                    <input type="text" id="search-bar" class="form-control" placeholder="Search for books...">
                </form>
            </div>
            
            <!-- Sort and Filter Form -->
            <div class="col-md-3">
                <form id="filter-form" method="GET" action="/books" class="mb-3 d-flex">
                    <!-- Publisher Filter Dropdown -->
                    <div class="dropdown me-6 flex-grow-1">
                        <button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Publishers
                        </button>
                        <ul class="dropdown-menu p-3" style="width:100px; max-height: 200px; overflow-y: auto;">
                            {% for publisher in publishers %}
                            <li class="form-check">
                                <input type="checkbox" class="form-check-input publisher-checkbox" name="publishers" value="{{ publisher }}" id="publisher_{{ publisher }}" {% if publisher in selected_publishers %}checked{% endif %}>
                                <label class="form-check-label" for="publisher_{{ publisher }}">{{ publisher }}</label>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </form>
            </div>
        </div>
    
        <div class="scroll-container" id="scroll-container">
            <ul>
                {% for book in books %}
                <li>
                    <img src="{{ url_for('static', filename=book.imagepath) }}" alt="Cover image of {{ book.title }}"><br>
                    <strong>{{ book.title }}</strong><br>
                    <span class="author">by {{ book.author }}</span><br>
                    <span class="publisher">{{ book.publisher }}</span>, 
                    <span class="publication-year">{{ book.publicationyear }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>


{% endblock %}